<!-- login.html -->
{% extends "base.html" %}
{% block title %}VigiFroid Â· {{ _('Login') }}{% endblock %}
{% set page_class = "page login-page" %}

{# â­ Ø³ØªØ§ÙŠÙ„ Ø®Ø§Øµ Ø¨Ù‡Ø§Ø¯ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø· (Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„ØªØ±Ø­ÙŠØ¨) #}
{% block styles %}
  {{ super() }}
  <style>
    .brand-hero-anim-title {
      opacity: 0;
      animation: heroFadeDown 0.6s ease-out forwards;
    }

    .brand-hero-anim-subtitle {
      opacity: 0;
      animation: heroFadeUp 0.6s ease-out 0.15s forwards;
    }

    @keyframes heroFadeDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes heroFadeUp {
      from {
        opacity: 0;
        transform: translateY(5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 100vh; padding: 20px;">
  <div class="card w-100 shadow-sm" style="max-width: 400px;">
    <div class="card-body text-center">

      <div class="brand-hero mb-3">
        <h1 class="h4 mb-1 brand-hero-anim-title">{{ _('Welcome admin') }}</h1>
        <p class="text-muted small mb-0 brand-hero-anim-subtitle">{{ _('Please log in to continue') }}</p>
      </div>

      <form method="post" action="{{ url_for('auth.login') }}" oninput="validate()">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <div class="mb-3">
          <input id="username"
                 name="username"
                 type="text"
                 class="form-control"
                 autocomplete="username"
                 required
                 placeholder="{{ _('Username') }}">
        </div>

        <div class="mb-1 position-relative">
          <input id="password"
                 name="password"
                 type="password"
                 class="form-control"
                 autocomplete="current-password"
                 required
                 placeholder="{{ _('Password') }}">
          <button type="button"
                  class="btn btn-link position-absolute top-50 translate-middle-y password-toggle-pos password-toggle-btn"
                  onclick="togglePwd()">
            {{ _('Show') }}
          </button>
        </div>

        {# ğŸ”‘ Ø±Ø§Ø¨Ø· "Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ" #}
        <div class="mb-3 text-end">
          <a href="{{ url_for('auth.forgot_password') }}"
             class="small text-decoration-none">
            {{ _('Forgot password?') }}
          </a>
        </div>

        <button id="loginBtn"
                class="btn btn-primary w-100"
                type="submit"
                disabled>
          {{ _('Login') }}
        </button>
      </form>

    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ğŸ” ØªÙˆØ¬ÙŠÙ‡ Ø£ÙˆÙ„ Ø²ÙŠØ§Ø±Ø© Ø¥Ù„Ù‰ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ / onboarding
  (function () {
    try {
      // Ø¥Ø°Ø§ Ù…Ø§Ø²Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ Ø¯Ø§Ø±Ø´ onboarding ÙÙ‡Ø§Ø¯ Ø§Ù„Ø¬Ù‡Ø§Ø²
      if (!localStorage.getItem('vf_onboarding_done')) {
        // Ù†ØªØ£ÙƒØ¯ Ø£Ù†Ù†Ø§ Ù…Ø§Ø´ÙŠ Ø£ØµÙ„Ø§Ù‹ ÙØµÙØ­Ø© welcome (Ù„ØªÙØ§Ø¯ÙŠ loop)
        if (!window.location.pathname.includes('welcome')) {
          window.location.href = "{{ url_for('auth.welcome') }}";
        }
      }
    } catch (e) {
      // ÙØ­Ø§Ù„Ø© Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø§ ÙƒÙŠØ¯Ø¹Ù…Ø´ localStorageØŒ Ù†Ø®Ù„ÙŠÙ‡ ÙŠÙƒÙ…Ù„ Ø¹Ø§Ø¯ÙŠ Ù„Ù„Ù‘ÙˆØ¬ÙŠÙ†
    }
  })();

  function togglePwd() {
    const passwordInput = document.getElementById('password');
    const toggleButton = document.querySelector('.password-toggle-btn');
    if (!passwordInput || !toggleButton) return;

    const isPassword = passwordInput.type === 'password';
    passwordInput.type = isPassword ? 'text' : 'password';
    toggleButton.textContent = isPassword ? '{{ _("Hide") }}' : '{{ _("Show") }}';
  }

  function validate() {
    const uEl = document.getElementById('username');
    const pEl = document.getElementById('password');
    const btn = document.getElementById('loginBtn');
    if (!uEl || !pEl || !btn) return;

    const u = uEl.value.trim();
    const p = pEl.value.trim();
    btn.disabled = !(u && p);
  }

  window.addEventListener('load', () => {
    const uEl = document.getElementById('username');
    if (uEl) uEl.focus();
    validate();
  });
</script>
{% endblock %}
